<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D√©tail de la Qu√™te</title>
    <link rel="stylesheet" href="/style.css">
    <style>
        /* Scoped styles from template, adapted to use existing style.css where possible */
        body { display: flex; align-items: center; justify-content: center; padding: 40px 20px; }
        .glass-container { max-width: 900px; width: 100%; }
        .quest-title { font-size: 2.8rem; }
        .quest-image { height: 300px; }
        .accept-button { padding: 20px; }
        .call-button { padding: 20px 30px; }
        @media (max-width: 768px) {
            .quest-title { font-size: 2.2rem; }
            .quest-image { height: 200px; }
        }
    </style>
</head>
<body>
    <div class="glass-container">
        <div class="quest-header">
            <h1 id="q-title" class="quest-title">Titre de la qu√™te</h1>
            <div id="q-meta" class="quest-meta">
                <!-- badges go here -->
            </div>
        </div>

        <img id="q-image" src="/placeholder.jpg" alt="Image de la qu√™te" class="quest-image">

        <div class="info-grid">
            <div class="info-card">
                <span class="info-icon">üìç</span>
                <div class="info-label">Localisation</div>
                <div id="q-location" class="info-value">‚Äî</div>
            </div>

            <div class="info-card">
                <span class="info-icon">üí∞</span>
                <div class="info-label">R√©compense</div>
                <div id="q-reward" class="info-value reward-highlight">‚Äî</div>
            </div>

            <div class="info-card">
                <span class="info-icon">‚è±Ô∏è</span>
                <div class="info-label">Dur√©e</div>
                <div id="q-duration" class="info-value">‚Äî</div>
            </div>
        </div>

        <div class="section">
            <h2 class="section-title">üìù Description</h2>
            <p id="q-description" class="section-content">‚Äî</p>
        </div>

        <div class="section">
            <h2 class="section-title">‚úÖ Conditions requises</h2>
            <p id="q-conditions" class="section-content">‚Äî</p>
        </div>

        <div class="button-row">
            <button id="acceptBtn" class="accept-button">‚úì Accepter cette qu√™te</button>
            <button id="callBtn" class="call-button">üìû Appeler</button>
        </div>
        <button id="backBtn" class="back-button">‚Üê Retour aux qu√™tes</button>
    </div>

    <script>
        function qs(name){
            const params = new URLSearchParams(window.location.search);
            return params.get(name);
        }

        async function loadQuest(){
            const id = qs('id');
            if(!id) return alert('Aucune qu√™te sp√©cifi√©e');
            try{
                const res = await fetch('/api/quests/' + id);
                if(!res.ok) throw new Error('Not found');
                const q = await res.json();
                document.getElementById('q-title').textContent = q.title || 'Titre';
                document.getElementById('q-image').src = q.image || '/placeholder.jpg';
                const meta = document.getElementById('q-meta');
                meta.innerHTML = '';
                if(q.category) meta.appendChild(makeBadge(iconFor(q.category) + ' ' + capitalize(q.category)));
                if(q.duration) meta.appendChild(makeBadge('‚è±Ô∏è ' + q.duration));
                if(q.creator) meta.appendChild(makeBadge('üë§ ' + q.creator));

                document.getElementById('q-location').textContent = q.location || '‚Äî';
                document.getElementById('q-reward').textContent = (q.reward ? q.reward + ' FCFA' : '‚Äî');
                document.getElementById('q-duration').textContent = q.duration || '‚Äî';
                document.getElementById('q-description').innerHTML = q.description?.replace(/\n/g,'<br>') || '‚Äî';
                document.getElementById('q-conditions').innerHTML = q.conditions?.replace(/\n/g,'<br>') || 'Aucune condition sp√©cifi√©e.';

                document.getElementById('acceptBtn').addEventListener('click', ()=>{
                    if(confirm('Voulez-vous accepter cette qu√™te ?')){
                        alert('Vous avez accept√© la qu√™te. Le cr√©ateur sera notifi√©.');
                    }
                });

                document.getElementById('callBtn').addEventListener('click', ()=>{
                    if(q.creatorPhone) {
                        window.location.href = 'tel:' + q.creatorPhone;
                    } else {
                        alert('Num√©ro non disponible');
                    }
                });

            }catch(err){
                alert('Impossible de charger la qu√™te.');
            }
        }

        function makeBadge(text){
            const s = document.createElement('span');
            s.className = 'meta-badge';
            s.textContent = text;
            return s;
        }

        function iconFor(cat){
            switch((cat||'').toLowerCase()){
                case 'transport': return 'üöö';
                case 'achats': return 'üõí';
                case 'aide': return 'ü§ù';
                case 'publicite': return 'üì£';
                case 'enligne': return 'üíª';
                default: return 'üìå';
            }
        }

        function capitalize(s){ return s.charAt(0).toUpperCase()+s.slice(1); }

        document.getElementById('backBtn').addEventListener('click', ()=>{ window.location.href = '/'; });

        loadQuest();
    </script>
</body>
</html>
